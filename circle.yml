machine:
  pre:
    - |
      sudo curl -L -o /usr/bin/docker 'http://s3-external-1.amazonaws.com/circle-downloads/docker-1.8.1-circleci'
      sudo chmod 0755 /usr/bin/docker
      sudo service docker start

dependencies:
  override:
    - docker info
    - docker --version

checkout:
  post:
    - ./gradlew

test:
  override:
    - docker run -d -p 5050:5050 gordonw/dozy-service; sleep 10
    - curl --retry 10 --retry-delay 5 -v http://localhost:5050

deployment:
  hub:
    branch: master
    commands:
      - docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS
      - docker push gordonw/dozy-service
